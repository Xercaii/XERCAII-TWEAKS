<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment - Xercaii Tweaks</title>
    <link rel="stylesheet" href="styles/main.css">
    <script src="https://www.paypal.com/sdk/js?client-id=AcXnOz-4DsaN0mzqUB0fgrdErToBlHHArJ7K4h-OgUATv6b-t9zncp7OZW7HO1_6EiKXDy3GU2Vqch6D&currency=USD"></script>
</head>

<body>
    <header>
        <div class="logo">
            <img src="Extra/Images/goku-ultra-instinct.1920x1080.mp4" alt="Xercaii Tweaks Logo">
        </div>
        <nav>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="shop.html">Shop</a></li>
                <li><a href="#" id="menu-btn">Menu</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <h1>Complete Your Purchase</h1>
        <p>You're about to purchase the <span id="product-name"></span> utility for <span id="product-price"></span>.</p>
        <div id="paypal-button-container"></div>
    </main>

    <footer>
        <p>&copy; 2024 Xercaii Tweaks. All Rights Reserved.</p>
    </footer>

    <script src="scripts/main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const productName = 'Premium Utility'; // Set dynamically based on your needs
            const productPrice = '10.00'; // Set the price accordingly
            const productType = 'premium'; // Set the type for your product

            document.getElementById('product-name').textContent = productName;
            document.getElementById('product-price').textContent = `$${productPrice}`;

            paypal.Buttons({
                createOrder: function(data, actions) {
                    return actions.order.create({
                        purchase_units: [{
                            description: productName,
                            amount: {
                                value: productPrice
                            },
                            custom_id: productType // Custom field to pass the product type
                        }]
                    });
                },
                onApprove: function(data, actions) {
                    return actions.order.capture().then(function(details) {
                        // Send the payment information to the server to generate a token
                        fetch('/paypal-webhook', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                status: 'COMPLETED',
                                purchase_units: details.purchase_units,
                                orderID: data.orderID // Pass the PayPal order ID to the server
                            })
                        }).then(response => response.json())
                          .then(data => {
                              if (data.token) {
                                  window.location.href = `/success.html?token=${data.token}`;
                              } else {
                                  alert('There was an issue with your payment. Please contact support.');
                              }
                          });
                    });
                },
                onError: function(err) {
                    console.error(err);
                    alert('An error occurred during the transaction. Please try again.');
                }
            }).render('#paypal-button-container');
        });
    </script>
</body>

</html>